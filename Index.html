<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fantasy Lineup Manager</title>
  <style>
    body { font-family: system-ui, sans-serif; background:#0b1220; color:#eaf0ff; margin:0; }
    .container { max-width:1100px; margin:0 auto; padding:24px; }
    .header { display:flex; justify-content:space-between; align-items:center; }
    .title { font-size:24px; font-weight:700; }
    .card { background:#121a2b; border-radius:12px; padding:16px; margin-top:16px; }
    .grid { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
    .slot { background:#0f192e; border:1px solid #223052; border-radius:10px; padding:12px; }
    select, button { font-size:14px; padding:6px; border-radius:8px; }
    .actions { display:flex; gap:10px; flex-wrap:wrap; }
    .pill { padding:6px 10px; border-radius:999px; background:#0f1e35; border:1px solid #223052; color:#8aa0c8; }
    .teamCard { background:#0f192e; border-radius:12px; padding:12px; }
    .list { max-height:160px; overflow:auto; }
    .error { color:#ff6b6b; }
    .success { color:#70e000; }
  </style>
</head>
<body>
  <div id="root">Loading...</div>

  <script>
    // Simple CSV parser
    function parseCSV(text) {
      const rows = text.trim().split("\n").map(r => r.split(","));
      const header = rows[0];
      const data = rows.slice(1);
      return { header, data };
    }

    function buildTeams(header, data) {
      const iManager = header.indexOf("Manager");
      const iPlayer  = header.indexOf("Player");
      const iPos     = header.indexOf("Position");
      if (iManager===-1||iPlayer===-1||iPos===-1) throw new Error("CSV must have Manager, Player, Position columns");

      const teams = {};
      data.forEach(row => {
        const manager = row[iManager];
        const player  = row[iPlayer];
        const pos     = row[iPos];
        if (!teams[manager]) teams[manager] = [];
        teams[manager].push({ name: player, pos });
      });
      return teams;
    }

    const POSITIONS = ["QB","RB1","RB2","WR1","WR2","FLEX","TE","K","DEF"];
    const FLEX_ELIG = new Set(["RB","WR","TE"]);

    function byPos(players, slot) {
      if (slot==="RB1"||slot==="RB2") return players.filter(p=>p.pos==="RB");
      if (slot==="WR1"||slot==="WR2") return players.filter(p=>p.pos==="WR");
      if (slot==="FLEX") return players.filter(p=>FLEX_ELIG.has(p.pos));
      return players.filter(p=>p.pos===slot);
    }

    async function init() {
      let teams = {};
      try {
        const res = await fetch("rosters.csv");
        const text = await res.text();
        const {header,data} = parseCSV(text);
        teams = buildTeams(header,data);
      } catch(e) {
        document.getElementById("root").innerHTML = "<div class='error'>Error loading rosters.csv: "+e.message+"</div>";
        return;
      }

      let manager = Object.keys(teams)[0] || "";
      let lineup = Object.fromEntries(POSITIONS.map(s=>[s,""]));
      let locked = false;
      let message = "";

      function render() {
        const root = document.getElementById("root");
        const allPlayers = Object.entries(teams).flatMap(([m,roster])=>roster.map(p=>({...p,team:m})));
        const managerRoster = teams[manager]||[];

        root.innerHTML = `
          <div class="container">
            <div class="header">
              <div class="title">Fantasy Lineup Manager</div>
              <div class="pill">Manager</div>
              <select id="managerSel">
